- 为什么要做MySQL读写分离
1. 读多写少
2. 高可用性
3. 在单机的情况下，一般我们做数据库优化都会加索引，但是加了索引对查询有优化，但是会影响写入，因为写入数据会更新索引。所以做了主从之后，我们可以单独的针对从库(读库)做索引上的优化，而主库(写库)可以减少索引而提高写的效率。
- 基于程序代码内部实现

在代码中根据select、insert进行路由分类，这类方法也是目前生产环境应用最广泛的。优点是性能较好，因为在程序代码中实现，不需要增加额外的设备作为硬件开支，缺点是需要开发人员来实现，运维人员无从下手。
- 配置MySQL服务器主节点
```
log-bin=mysql-bin         <!--开启二进制日志-->
log-slave-updates = true     <!--允许从复制日志-->
server-id       = 10         <!--设置master的优先级，数字越小优先级越高-->
```
- 配置MySQL服务器从节点
```
log-bin=mysql-bin          <!--开启二进制日志-->
relay-log=relay-log-bin     <!--设置读取日志-->
relay-log-index=slave-relay-bin.index    <!--设置同步主服务器日志-->
server-id       = 11            <!--设置优先级，要比master低-->
```
### 在从服务器设置主服务器，实现主从配置
```sql
CHANGE MASTER TO
MASTER_HOST='192.168.106.131',#Master的ip
MASTER_USER='repl',#你创建的用户
MASTER_PASSWORD='123456',#password
MASTER_LOG_FILE='mysql-bin.000003',#主服务器上的File
MASTER_LOG_POS=155;#刚刚保存的position
```
### 开启主从
start slave
### 检查从服务器状态
show slave status\G
如果出现slave-IO-Running，slave-SQL-Running都为Yes就ok
# 主从库一致性问题
## 串行化问题
这里有一个非常重要的一点，就是从库同步主库数据的过程是串行化的，也就是说主库上并行的操作，在从库上会串行执行。所以这就是一个非常重要的点了，由于从库从主库拷贝日志以及串行执行SQL的特点，在高并发场景下，从库的数据一定会比主库慢一些，是有延时的。所以经常出现，刚写入主库的数据可能是读不到的，要过几十毫秒，甚至几百毫秒才能读取到。
- 解决方法-并行复制

所谓并行复制，指的是从库开启多个线程，并行读取relay log中不同库的日志，然后并行重放不同库的日志，这是库级别的并行。
## 数据丢失问题
如果主库突然宕机，然后恰好数据还没同步到从库，那么有些数据可能在从库上是没有的，有些数据可能就丢失了。
- 解决方法-半同步复制

这个所谓半同步复制，semi-sync复制，指的就是主库写入binlog日志之后，就会将强制此时立即将数据同步到从库，从库将日志写入自己本地的relay log之后，接着会返回一个ack给主库，主库接收到至少一个从库的ack之后才会认为写操作完成了。